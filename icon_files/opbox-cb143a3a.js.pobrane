!function(){function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(n,!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e,t,n){return(l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&c(r,n.prototype),r}).apply(null,arguments)}function d(e){var t="function"==typeof Map?new Map:void 0;return(d=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return l(e,arguments,u(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),c(i,e)})(e)}function h(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e,t,n){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function v(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var g=function(){function n(){t(this,n),this.lastRequest=null}return i(n,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("GET",e,{},t)}},{key:"post",value:function(e,t,n){return this.request("POST",e,t,n)}},{key:"put",value:function(e,t,n){return this.request("PUT",e,t,n)}},{key:"patch",value:function(e,t,n){return this.request("PATCH",e,t,n)}},{key:"delete",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("DELETE",e,{},t)}},{key:"request",value:function(e,t,i,r){var o=r.headers,a=void 0===o?{}:o,s=r.validateStatus,u=void 0===s?n.defaultValidateFunction:s,c=r.withCredentials,l=void 0!==c&&c,d=r.cancelLast,h=void 0!==d&&d,f=r.onUploadProgress,m=void 0===f?function(){}:f;h&&this.cancelLastRequest();var v=n.makeRequest(e,t,i,a,l,m);return this.lastRequest=v,n.toPromise(v,u)}},{key:"cancelLastRequest",value:function(){null!==this.lastRequest&&this.lastRequest.abort()}}],[{key:"makeRequest",value:function(e,t,i,r,o,a){var s=new XMLHttpRequest;return s.open(e,t,!0),Object.keys(r).forEach((function(e){s.setRequestHeader(e,r[e])})),s.withCredentials=o,s.upload&&s.upload.addEventListener("progress",a),s.send(n.serialize(e,i)),s}},{key:"toPromise",value:function(e,t){return new Promise((function(i,r){e.readyState===XMLHttpRequest.DONE?n.checkResponse(e,t,i,r):e.onreadystatechange=function(){e.readyState===XMLHttpRequest.DONE&&n.checkResponse(e,t,i,r)}}))}},{key:"serialize",value:function(t,n){return"POST"===t||"PUT"===t||"PATCH"===t?"object"!==e(n)||n instanceof Blob||n instanceof FormData?n:JSON.stringify(n):null}},{key:"checkResponse",value:function(e,t,i,r){var o=e.status,a=e.responseText,s=t(o),u={};try{u=JSON.parse(a)}catch(e){u=a}s?i({status:o,data:u,headers:n.parseHeaders(e.getAllResponseHeaders())}):r({status:o,data:u,message:"Request failed with status code ".concat(o)})}},{key:"defaultValidateFunction",value:function(e){return 200===e||201===e||202===e||204===e}},{key:"parseHeaders",value:function(e){var t,n,i,r={};return e.split("\n").forEach((function(e){i=e.indexOf(":"),t=e.substr(0,i).trim().toLowerCase(),n=e.substr(i+1).trim(),t&&(r[t]=r[t]?"".concat(r[t],", ").concat(n):n)})),r}}]),n}(),p=function(){function e(){var n=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=i.baseDomain,o=i.edgeHost,a=i.lazyBoxNames,s=void 0===a?[]:a,u=i.cookieMonster,c=void 0===u?{}:u,l=i.pinter,d=void 0===l?{}:l;t(this,e),this.baseDomain=r,this.edgeHost=o,this.lazyBoxNames=s,this.cookieMonster=c,this.pinter=d,this.isLazy=function(){return n.lazyBoxNames.length>0}}return i(e,null,[{key:"getGlobal",value:function(e){return e.opbox||{}}},{key:"fromWindow",value:function(t){return new e(e.getGlobal(t).config)}},{key:"assignToGlobal",value:function(e,t){e.opbox=e.opbox||{},Object.assign(e.opbox,t)}},{key:"getWhitelist",value:function(e){return[].concat(v(Object.keys(e)),["initialized","config"])}}]),e}(),y=function(){function e(){var n=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).targetWindow;t(this,e),this.targetWindow=n}return i(e,[{key:"document",get:function(){return this.targetWindow.document}}]),e}(),b=function(e){function n(e){var i;return t(this,n),(i=h(this,u(n).call(this,e))).message=e,i.name="PageRenderingError",i}return s(n,e),n}(d(Error));function k(t){return"object"===e(t)&&null!==t}function w(e){return Array.isArray(e)}function x(e){return"function"==typeof e}function E(e){return[].slice.call(e)}function C(e,t,n){return Object.assign(e.createElement(t),n)}function P(){}function S(e,t,n){var i;return function(){for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];var s=this,u=function(){i=null,n||e.apply(s,o)},c=n&&!i;return clearTimeout(i),i=setTimeout(u,t),c&&e.apply(s,o),i}}function T(e,t){return e.concat(t)}function O(t,n){for(var i=arguments.length,r=new Array(i>2?i-2:0),o=2;o<i;o++)r[o-2]=arguments[o];if(0===r.length)return t=n;var a=[].concat(r),s=a.shift();return(t="object"!==e(t)?{}:t)[s]=O.apply(void 0,[t[s],n].concat(v(a))),t}var A=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.data,r=n.headers;t(this,e),this.data=i,this.headers=r}return i(e,[{key:"valid",get:function(){return k(this.data)}}]),e}(),j=function(e){function n(){return t(this,n),h(this,u(n).apply(this,arguments))}return s(n,e),i(n,[{key:"valid",get:function(){return f(u(n.prototype),"valid",this)&&k(this.headers)&&k(this.renderingResult)&&n.allowedStatuses.indexOf(this.renderingStatus)>=0}},{key:"renderingResult",get:function(){return this.data.pageRenderingResult}},{key:"renderingStatus",get:function(){return this.data.renderingStatus}},{key:"renderingContext",get:function(){return JSON.parse(this.headers["page-context"])}}],[{key:"allowedStatuses",get:function(){return["OK","DATA_SOURCE_ERRORS"]}}]),n}(A),V=function(){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,n),this.dataSources=e}return i(n,[{key:"resolve",value:function(t,n){var i,o=t.value;if("DATA_SOURCE"===t.type){var a=this.dataSources[o];return Object.assign({},a&&a.data&&r({},n,a.data),a&&!(null===(i=a.metadata)||"object"!==e(i)||0===Object.keys(i).length)&&r({},"".concat(n,".$meta"),a.metadata))}return r({},n,o)}}]),n}(),R=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t(this,e);var r=n.boxes,o=void 0===r?[]:r,a=n.dataSources,s=void 0===a?[]:a,u=n.parameters,c=void 0===u?[]:u,l=n.locale,d=n.pageUrl,h=n.canonicalUrl,f=i.edgeHost,m=i.env,v=i.isDirect,g=i.renderDateTime;this.boxes=o,this.dataSources=s,this.context={locale:l,pageUrl:d,canonicalUrl:h,edgeHost:f,env:m,isDirect:v,renderDateTime:g},this.parameters=c,this.parameterResolver=new V(this.resolvedDataSources)}return i(e,[{key:"resolvedDataSources",get:function(){return this.dataSources.reduce((function(e,t){return Object.assign(e,r({},t.name,t))}),{})}},{key:"resolvedMeta",get:function(){var e=this,t=Object.keys(this.context).reduce((function(t,n){return Object.assign(t,r({},"$page.".concat(n),e.context[n]))}),{}),n=this.parameters.reduce((function(t,n){return Object.assign(t,e.parameterResolver.resolve(n,n.name))}),{});return Object.assign({},t,n)}},{key:"resolved",get:function(){return{boxes:this.boxes,dataSources:this.resolvedDataSources,meta:this.resolvedMeta}}}]),e}(),I=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.boxes,r=void 0===i?{}:i,o=n.dataSources,a=void 0===o?{}:o,s=n.meta,u=void 0===s?{}:s;t(this,e),this.boxes=r,this.dataSources=a,this.meta=u,this.parameterResolver=new V(this.dataSources)}return i(e,[{key:"resolved",get:function(){return{boxes:this.resolvedBoxes,dataSources:this.dataSources,meta:this.meta}}},{key:"resolvedBoxes",get:function(){var e=this;return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,i={};return Object.keys(e).forEach((function(r){i[r]=t.call(n,e[r],r,e)})),i}(this.boxes,(function(t){var n=Object.keys(t).reduce((function(n,i){var r=e.parameterResolver.resolve(t[i],i);return Object.assign(n,r)}),{});return Object.assign(n,e.pageProperties)}))}},{key:"pageProperties",get:function(){var e=this;return Object.keys(this.meta).filter((function(e){return 0===e.indexOf("$page.")})).reduce((function(t,n){return Object.assign(t,r({},n,e.meta[n]))}),{})}}],[{key:"createEmpty",value:function(){return new e}}]),e}();function N(e){return e>=200&&e<300||502===e}var M=function(){function e(n){var i=n.httpClient;t(this,e),this.httpClient=i}return i(e,[{key:"getPageData",value:function(e){var t={headers:{Accept:"application/vnd.opbox-web.v2+json"},cancelLast:!0,validateStatus:N};return this.httpClient.get(e,t).then((function(e){var t=new A(e);if(!t.valid)throw new b("Opbox response is invalid.");return new I(t.data)}))}},{key:"getPageRenderingResult",value:function(t){var n={headers:{Accept:"application/vnd.opbox-web.v3+json"},cancelLast:!0,validateStatus:N};return this.httpClient.get(t,n).then((function(t){return e.mapPageRenderingResponse(t)}))}},{key:"createAPI",value:function(){return{getData:this.getPageData.bind(this)}}}],[{key:"mapPageRenderingResponse",value:function(e){var t=new j(e);if(!t.valid)throw new b("Page rendering response is invalid.");var n=t.renderingResult,i=t.renderingContext;return new R(n,i)}}]),e}(),B=function(){function e(){var n=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).meta,i=void 0===n?{}:n,r=arguments.length>1?arguments[1]:void 0;t(this,e),this.appContext=r,this.meta=i}return i(e,[{key:"updateMetaRobots",value:function(){var e=this.appContext.document.querySelector('head meta[name="robots"]');e&&this.meta&&e.setAttribute("content",[this.meta.noindexCondition?"noindex":"index",this.meta.nofollowCondition?"nofollow":"follow"].join(", "))}},{key:"render",value:function(){this.updateMetaRobots()}}]),e}(),W=function(){function e(n){var i=n.appContext,r=n.analytics,o=n.updateComponentCallback,a=void 0===o?P:o,s=n.beforeUpdateComponentCallback,u=void 0===s?P:s;t(this,e),this.appContext=i,this.rawData=I.createEmpty(),this.listeners={},this.analytics=r,this.updateComponentCallback=a,this.beforeUpdateComponentCallback=u}return i(e,[{key:"registerListener",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:P;if(this.rawData.boxes[e]){var i=this.rawData.resolved.boxes[e];setTimeout((function(){t(i)}),0)}this.listeners[e]={onChange:t,onProgress:n}}},{key:"triggerChangeListener",value:function(e){var t=this;this.rawData=e;var n=this.rawData.resolved,i=n.boxes,r=n.meta;Object.keys(i).forEach((function(e){var n=i[e];if(void 0!==n){t.updateComponentCallback(e,n);var r=t.listeners[e];r&&x(r.onChange)&&setTimeout((function(){return r.onChange(n)}),0)}}));var o=r.defaultCustomParams;this.analytics&&this.analytics.updateCustomParams(o),new B({meta:r},this.appContext).render()}},{key:"triggerProgressListener",value:function(){var e=this;this.beforeUpdateComponentCallback(),Object.keys(this.listeners).forEach((function(t){var n=e.listeners[t];n&&x(n.onProgress)&&setTimeout((function(){return n.onProgress()}),0)}))}}]),e}();"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var L=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e,t){e.exports=function(){function e(e){return e instanceof Object&&e.constructor===Object}return function(t){var n=t;e(t)||(n={});for(var i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];return r.forEach((function(t){e(t)&&(n=function t(n,i){var r=n,o=i;e(n)||(r={}),e(i)||(o={});var a=Object.keys(r),s=Object.keys(o),u={};return a.forEach((function(n){-1!==s.indexOf(n)?null===r[n]?u[n]=o[n]:e(r[n])&&e(o[n])?u[n]=t(r[n],o[n]):u[n]=o[n]:u[n]=r[n]})),s.forEach((function(e){-1===a.indexOf(e)&&(u[e]=o[e])})),u}(n,t))})),n}}()})),U=function(){function e(n){var i=n.targetWindow,r=n.boxes,o=void 0===r?[]:r,a=n.significantElementSizePercentage,s=void 0===a?.75:a,u=n.timeoutValue,c=void 0===u?500:u,l=n.debounceTimeoutValue,d=void 0===l?20:l;t(this,e),this.targetWindow=i,this.config={timeoutValue:c,debounceTimeoutValue:d,significantElementSizePercentage:s},this.resetState(),this.boxes=o.length?o:e.getBoxViewEnabledNodes(i.document),this.visibleElements=[],this.scrollHandlerWithContext=this.scrollHandler.bind(this),this.scrollEndHandler=S(this.resetCurrentlyVisibleElementsAfterScroll,this.config.debounceTimeoutValue),this.resizeEndHandler=S(this.resizeHandler.bind(this),this.config.debounceTimeoutValue),this.resetCurrentlyVisibleElementsOnTimeout=S(this.resetCurrentlyVisibleElements.bind(this),this.config.debounceTimeoutValue),this.markCurrentlyVisibleElementsAsSeenOnTimeout=S(this.markCurrentlyVisibleElementsAsSeen.bind(this),this.config.timeoutValue)}return i(e,[{key:"setUserViewport",value:function(){this.state.userViewport=e.getUserViewport(this.targetWindow)}},{key:"resetState",value:function(){var t=(new Date).getTime();this.state={isScrolling:!1,scrollStartTime:t,counterStartTime:t,userViewport:e.getUserViewport(this.targetWindow)}}},{key:"createEvent",value:function(e){var t=this.targetWindow.document.createEvent("CustomEvent");return t.initCustomEvent(e,!0,!0,{}),t}},{key:"isSignificantPartOfElementVisible",value:function(t){var n=t.right-t.left,i=t.bottom-t.top,r=e.getElementVisibileDimensionLength(t.left,t.right,this.state.userViewport.width,n);return e.getElementVisibileDimensionLength(t.top,t.bottom,this.state.userViewport.height,i)*r/(n*i)>this.config.significantElementSizePercentage}},{key:"putVisibleElementsToBuffer",value:function(){var t=!1,n=this.visibleElements.slice();this.visibleElements=[];for(var i=0;i<this.boxes.length;i+=1){var r=null;try{r=this.boxes[i].getBoundingClientRect()}catch(e){t=!0,this.boxes[i]=null}r&&(this.isSignificantPartOfElementVisible(r)?(this.visibleElements.push(this.boxes[i]),-1===n.indexOf(this.boxes[i])&&this.boxes[i].dispatchEvent(this.createEvent("inViewport"))):-1!==n.indexOf(this.boxes[i])&&this.boxes[i].dispatchEvent(this.createEvent("outOfViewport")))}t&&(this.boxes=this.boxes.filter((function(e){return null!==e})),e.getBoxViewEnabledNodes(this.targetWindow.document).forEach(this.addBox.bind(this)))}},{key:"markElementAsSeen",value:function(e,t){if(e){var n=parseInt(e.getAttribute("data-visible-for"),10)||0;(!e.getAttribute("data-seen")&&n+t)>=this.config.timeoutValue&&(e.setAttribute("data-seen",!0),e.dispatchEvent(this.createEvent("boxView"))),e.setAttribute("data-visible-for",n+t)}}},{key:"markPreviouslyVisibleElementsAsSeen",value:function(){var e=this,t=(new Date).getTime();this.visibleElements.forEach((function(n){e.markElementAsSeen(n,t-e.state.counterStartTime)}))}},{key:"markPreviouslyVisibleElementsAsSeenAfterScroll",value:function(){var e=this;this.visibleElements.forEach((function(t){e.markElementAsSeen(t,e.state.scrollStartTime-e.state.counterStartTime)}))}},{key:"markCurrentlyVisibleElementsAsSeen",value:function(){var e=this;this.visibleElements.forEach((function(t){e.markElementAsSeen(t,e.config.timeoutValue)}))}},{key:"resetCurrentlyVisibleElements",value:function(){this.markPreviouslyVisibleElementsAsSeen(),this.putVisibleElementsToBuffer(),this.markCurrentlyVisibleElementsAsSeenOnTimeout(),this.resetState()}},{key:"resetCurrentlyVisibleElementsAfterScroll",value:function(){this.markPreviouslyVisibleElementsAsSeenAfterScroll(),this.putVisibleElementsToBuffer(),this.markCurrentlyVisibleElementsAsSeenOnTimeout(),this.resetState()}},{key:"scrollHandler",value:function(){this.state.isScrolling||(this.state.scrollStartTime=(new Date).getTime(),this.state.isScrolling=!0),clearTimeout(this.markCurrentlyVisibleElementsAsSeenOnTimeout()),this.scrollEndHandler()}},{key:"resizeHandler",value:function(){this.setUserViewport(),this.resetCurrentlyVisibleElements()}},{key:"addBox",value:function(e){-1===this.boxes.indexOf(e)&&this.boxes.push(e)}},{key:"isBoxInViewport",value:function(e){return-1!==this.visibleElements.indexOf(e)}},{key:"clearAttributes",value:function(e){this.boxes.forEach((function(t){t&&t.matches(e)&&(t.removeAttribute("data-seen"),t.removeAttribute("data-visible-for"))}))}},{key:"markBoxAsRendered",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";n&&this.clearAttributes(n),t.getAttribute("data-analytics-enabled")&&this.addBox(t),e.getBoxViewEnabledNodes(t).forEach(this.addBox.bind(this)),this.resetCurrentlyVisibleElementsOnTimeout()}},{key:"markBoxAsVisible",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.addBox(e),t?this.markElementAsSeen(e,this.config.timeoutValue):this.resetCurrentlyVisibleElementsOnTimeout()}},{key:"recursivelyMarkBoxAsVisible",value:function(t){var n=this;this.addBox(t),e.getBoxViewEnabledNodes(t).forEach((function(e){n.addBox(e)})),this.resetCurrentlyVisibleElementsOnTimeout()}},{key:"removeBox",value:function(e){this.boxes=this.boxes.filter((function(t){return t!==e}))}},{key:"markBoxAsHidden",value:function(e){this.removeBox(e),this.resetCurrentlyVisibleElementsOnTimeout()}},{key:"recursivelyMarkBoxAsHidden",value:function(t){var n=this;this.removeBox(t),e.getBoxViewEnabledNodes(t).forEach((function(e){n.removeBox(e)})),this.resetCurrentlyVisibleElementsOnTimeout()}},{key:"trackBoxScroll",value:function(e){e.addEventListener("scroll",this.scrollHandlerWithContext)}},{key:"initialize",value:function(){this.targetWindow.addEventListener("scroll",this.scrollHandlerWithContext),this.targetWindow.addEventListener("resize",this.resizeEndHandler),this.resetCurrentlyVisibleElements()}},{key:"createAPI",value:function(){return{markBoxAsRendered:this.markBoxAsRendered.bind(this),markBoxAsVisible:this.markBoxAsVisible.bind(this),recursivelyMarkBoxAsVisible:this.recursivelyMarkBoxAsVisible.bind(this),markBoxAsHidden:this.markBoxAsHidden.bind(this),recursivelyMarkBoxAsHidden:this.recursivelyMarkBoxAsHidden.bind(this),trackBoxScroll:this.trackBoxScroll.bind(this),isBoxInViewport:this.isBoxInViewport.bind(this)}}}],[{key:"getBoxViewEnabledNodes",value:function(e){var t=E(e.querySelectorAll("[".concat("data-analytics-enabled","]"))),n=E(e.querySelectorAll("[".concat("data-analytics-proxied","]"))).reduce((function(e,t){var n=E(t.querySelectorAll("[".concat("data-analytics-enabled","]")));return n.length?T(e,n):e}),[]),i=n.filter((function(e,t){return n.indexOf(e)===t}));return t.filter((function(e){return-1===i.indexOf(e)}))}},{key:"getElementVisibileDimensionLength",value:function(e,t,n,i){return e>0?e<n?t<n?t-e:n-e:0:t<0?0:t<n?t:i}},{key:"getUserViewport",value:function(e){return{width:e.innerWidth,height:e.innerHeight}}}]),e}(),D=function(){function e(n){var i=n.targetWindow,r=n.onCycleComplete;t(this,e),this.window=i,this.document=this.window.document,this.onCycleComplete=r,this.initTimeStamp=null,this.engagementCycleStartTime=null,this.engagementTime=0,this.maxScrollBottom=this.getScrollBottom(),this.previousInteractionTime=null,this.handleInteraction=this.handleInteraction.bind(this),this.refreshEngagementCycle=this.refreshEngagementCycle.bind(this)}return i(e,[{key:"getTimeSpentOnPage",value:function(){return e.getCurrentTime()-this.initTimeStamp}},{key:"updateEngagementTime",value:function(e){if(this.previousInteractionTime){var t;if(this.previousInteractionTime<this.engagementCycleStartTime){var n=e-this.engagementCycleStartTime,i=2e3-(this.engagementCycleStartTime-this.previousInteractionTime);t=Math.min(n,i)}else{var r=e-this.previousInteractionTime;t=Math.min(r,2e3)}this.engagementTime=this.engagementTime+t}}},{key:"updateMaxScrollBottom",value:function(){var e=this.getScrollBottom();e>this.maxScrollBottom&&(this.maxScrollBottom=e)}},{key:"getScrollBottom",value:function(){var e=this.window;return e.innerHeight+(e.scrollY||this.document.documentElement.scrollTop)}},{key:"getPageHeight",value:function(){var e=this.document,t=e.body,n=e.documentElement;return Math.max(t.scrollHeight,t.offsetHeight,n.clientHeight,n.scrollHeight,n.offsetHeight)}},{key:"endCycle",value:function(e){this.updateEngagementTime(e),this.engagementTime>0&&this.onCycleComplete({engagementTime:this.getEngagementTimeWithLimit(),scrollBottom:this.maxScrollBottom,pageHeight:this.getPageHeight()});var t=e-2e3;this.previousInteractionTime<t&&(this.previousInteractionTime=null),this.engagementTime=0,this.engagementCycleStartTime=e,this.maxScrollBottom=this.getScrollBottom()}},{key:"getEngagementTimeWithLimit",value:function(){return Math.min(this.engagementTime,6e3)}},{key:"handleInteraction",value:function(){var e=this.getTimeSpentOnPage();this.updateEngagementTime(e),this.updateMaxScrollBottom(),this.previousInteractionTime=e}},{key:"refreshEngagementCycle",value:function(){this.endCycle(this.getTimeSpentOnPage())}},{key:"startEngagementCycles",value:function(){this.engagementCycleStartTime=this.getTimeSpentOnPage(),setInterval(this.refreshEngagementCycle,6e3)}},{key:"initialize",value:function(){this.initTimeStamp=e.getCurrentTime();var t=e.attachListener;t(this.document,"click",this.handleInteraction),t(this.document,"mousemove",this.handleInteraction),t(this.document,"keydown",this.handleInteraction),t(this.document,"scroll",this.handleInteraction),t(this.window,"beforeunload",this.refreshEngagementCycle),this.startEngagementCycles()}}],[{key:"attachListener",value:function(e,t,n){e.addEventListener(t,n)}},{key:"getCurrentTime",value:function(){return(new Date).getTime()}}]),e}();function H(e,t,n){return e.addEventListener(t,n),{remove:function(){e.removeEventListener(t,n)}}}var q=function(){function e(n){var i=n.targetWindow,r=n.config,o=n.cookieMonsterClient,a=n.boxViewsMarker,s=n.sendPerformanceMetrics;t(this,e);var u=r.cookieMonster,c=(u=void 0===u?{}:u).boxViewDisabled,l=u.isEngagementMeasuringEnabled,d=u.defaultCustomParams,h=void 0===d?{}:d;this.targetWindow=i,this.document=this.targetWindow.document,this.boxViewDisabled=c,this.isEngagementMeasuringEnabled=l,this.cookieMonsterClient=o,this.boxViewsMarker=a,this.defaultCustomParams=h,this.eventCallbacks=[],this.sendPerformanceMetrics=s||P,this.engagementObserver=new D({targetWindow:i,onCycleComplete:this.sendPingEvent.bind(this)})}return i(e,[{key:"initialize",value:function(){this.cookieMonsterClient.initialize(),this.isEngagementMeasuringEnabled&&this.engagementObserver.initialize(),this.eventHandlers=[H(this.document,"change",this.handleChange.bind(this)),H(this.document,"click",this.handleClick.bind(this)),H(this.document,"mousedown",this.handleLinkClick.bind(this)),H(this.document,"submit",this.handleSubmit.bind(this)),H(this.document,"contextmenu",this.handleClick.bind(this)),H(this.document,"boxView",this.handleBoxView.bind(this)),H(this.targetWindow,"DOMContentLoaded",this.detectAdblock.bind(this))]}},{key:"teardown",value:function(){this.eventHandlers.forEach((function(e){e.remove()}))}},{key:"sendEvent",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.contextNode,i=t.action,r=t.label,o=void 0===r?"":r,a=t.value,s=t.customParams,u=void 0===s?{}:s;if(!n||!i)return{};var c=n.closest("[data-analytics-category]").getAttribute("data-analytics-category"),l=n.closest("[data-box-name]").getAttribute("data-box-name"),d=e.extractAnalyticsTags(n),h=e.extractGroups(n),f=d.length?{analyticsTags:d}:{},m=h.length?{groups:h}:{},v=Object.assign({},f,m,{boxName:l}),g=L(u,{_opbox:v},this.defaultCustomParams.ev),p={category:c,action:i,label:o,value:a,customParams:g};return this.cookieMonsterClient.send("event",p),this.eventCallbacks.length&&this.eventCallbacks.forEach((function(e){return e(p)})),p}},{key:"sendPingEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.engagementTime,n=e.scrollBottom,i=e.pageHeight;this.cookieMonsterClient.send("event",{category:"Engagement",label:"ping",customParams:{et:t,sb:n,ph:i}})}},{key:"sendClickEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"click"}))}},{key:"sendContextmenuEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"contextmenu"}))}},{key:"sendBoxInteractionEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"boxInteraction"}))}},{key:"sendItemViewEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"itemView"}))}},{key:"sendBoxViewEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"boxView"}))}},{key:"sendFormSubmitEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"submit"}))}},{key:"detectAdblock",value:function(){var e=this,t=C(this.document,"div",{innerHTML:"&nbsp;",className:"adsbox"});this.document.body.appendChild(t),this.targetWindow.setTimeout((function(){var n=0!==t.offsetHeight;e.cookieMonsterClient.send("event",{category:"clearPV",action:n,customParams:e.defaultCustomParams.ev}),e.document.body.removeChild(t)}),100)}},{key:"handleClick",value:function(e){this.handleBoxInteraction(e),this.handleLinkClick(e)}},{key:"handleBoxInteraction",value:function(t){if("function"==typeof t.target.closest){var n=t.target.closest("[data-analytics-interaction]");if(n){var i=e.getCustomParamsForInteraction({contextNode:n}),r=n.getAttribute("data-analytics-interaction-label")||"",o=n.getAttribute("data-analytics-interaction-value")||n.textContent.trim();this.sendBoxInteractionEvent({contextNode:n,label:r,value:o,customParams:i})}}}},{key:"handleLinkClick",value:function(t){if("function"==typeof t.target.closest){var n=t.target.closest("a");if(n&&n.hasAttribute("data-analytics-clickable")){var i=n.getAttribute("data-analytics-click-label")||"",r=n.getAttribute("data-analytics-click-value")||n.textContent.trim(),o="_blank"===n.getAttribute("target"),a=n.getAttribute("href"),s=t.pageX?{pageX:t.pageX,pageY:t.pageY}:{};"click"!==t.type||0!==t.button?"contextmenu"!==t.type?"mousedown"===t.type&&1===t.button&&this.sendClickEvent({contextNode:n,label:i,value:r,customParams:e.getCustomParamsForClick({contextNode:n,coordinates:s,destinationUrl:a,isNewTab:!0})}):this.sendContextmenuEvent({contextNode:n,label:i,value:r,customParams:e.getCustomParamsForClick({contextNode:n,coordinates:s,destinationUrl:a})}):this.sendClickEvent({contextNode:n,label:i,value:r,customParams:e.getCustomParamsForClick({contextNode:n,coordinates:s,destinationUrl:a,isNewTab:o||t.metaKey||t.ctrlKey})})}}}},{key:"handleChange",value:function(t){var n=t.target;if("select-one"===n.type&&n&&n.hasAttribute("data-analytics-selectable")){var i=n.options[n.selectedIndex].value,r=e.extractCustomParams(n,"data-analytics-select-custom-");this.sendEvent({contextNode:n,action:"change",value:i,customParams:r})}}},{key:"handleSubmit",value:function(e){var t=e.target;if(t&&"FORM"===t.nodeName&&t.hasAttribute("data-analytics-submittable")){var n=t.getAttribute("action"),i=v(t.elements).filter((function(e){return e.name})).map((function(e){return{name:e.name,value:e.value}})).sort((function(e,t){return e.name.toLowerCase().localeCompare(t.name.toLowerCase())})).map((function(e){return"".concat(e.name,"=").concat(e.value)})).join("&"),r=(i=i?"?".concat(i):"")?n+i:n;r=encodeURI(r),this.sendFormSubmitEvent({contextNode:t,value:r,label:"submitForm"})}}},{key:"markParentBoxAsVisible",value:function(e){var t=e.parentNode&&e.parentNode.closest("[data-analytics-enabled]");this.boxViewsMarker&&t&&!t.hasAttribute("data-seen")&&this.boxViewsMarker.markBoxAsVisible(t,!0)}},{key:"handleBoxView",value:function(t){var n=t.target;if(n&&n.hasAttribute("data-analytics-enabled")&&(!this.boxViewDisabled||n.hasAttribute("data-item"))&&!e.hasFragmentAsImmediateChild(n)){var i=n.getAttribute("data-analytics-view-value")||"",r=n.getAttribute("data-analytics-view-label")||"",o=e.getCustomParamsForView({contextNode:n});if(n.firstChild&&n.firstChild.nodeType===Node.ELEMENT_NODE&&Object.assign(o,e.extractCustomParams(n.firstChild,"data-analytics-view-custom-")),n.hasAttribute("data-item"))return this.markParentBoxAsVisible(n),void this.sendItemViewEvent({contextNode:n,label:r,value:i,customParams:o});Object.assign(o,e.extractBoxViewCustomParams(n)),this.sendBoxViewEvent({contextNode:n,value:i,customParams:o})}}},{key:"sendPageViewProxy",value:function(){this.sendPerformanceMetrics(),this.cookieMonsterClient.sendPageView(this.defaultCustomParams.pv),this.cookieMonsterClient.updateReferrer()}},{key:"sendEventProxy",value:function(e,t,n,i){return e.nodeType===Node.ELEMENT_NODE?this.sendEvent({contextNode:e,action:t,value:n,customParams:i}):this.sendEvent(e)}},{key:"sendItemViewEventProxy",value:function(t){var n=t.contextNode,i=t.label,r=t.value,o=t.customParams;this.sendItemViewEvent({contextNode:n,label:i,value:r,customParams:e.getCustomParamsForView({contextNode:n,customParams:o})})}},{key:"sendClickEventProxy",value:function(t){var n=t.contextNode,i=t.label,r=t.value,o=t.customParams,a=t.destinationUrl,s=t.isNewTab;if(s&&"boolean"!=typeof s)throw new Error("isNewTab property must be boolean");this.sendClickEvent({contextNode:n,label:i,value:r,customParams:e.getCustomParamsForClick({contextNode:n,destinationUrl:a,customParams:o,isNewTab:s})})}},{key:"sendContextmenuEventProxy",value:function(t){var n=t.contextNode,i=t.label,r=t.value,o=t.customParams,a=t.destinationUrl;this.sendContextmenuEvent({contextNode:n,label:i,value:r,customParams:e.getCustomParamsForClick({contextNode:n,destinationUrl:a,customParams:o})})}},{key:"sendBoxInteractionEventProxy",value:function(t){var n=t.contextNode,i=t.label,r=t.value,o=t.customParams;this.sendBoxInteractionEvent({contextNode:n,label:i,value:r,customParams:e.getCustomParamsForInteraction({contextNode:n,customParams:o})})}},{key:"updateCustomParams",value:function(e){var t=e.pv,n=void 0===t?{}:t,i=e.ev,r=void 0===i?{}:i;k(n)&&k(r)?this.defaultCustomParams={pv:n,ev:r}:console.log("Can not update custom params with non-object arguments!")}},{key:"registerEventCallback",value:function(e){e&&!this.eventCallbacks.includes(e)&&this.eventCallbacks.push(e)}},{key:"createAPI",value:function(){return{sendPageView:this.sendPageViewProxy.bind(this),sendEvent:this.sendEventProxy.bind(this),sendItemViewEvent:this.sendItemViewEventProxy.bind(this),sendClickEvent:this.sendClickEventProxy.bind(this),sendContextmenuEvent:this.sendContextmenuEventProxy.bind(this),sendBoxInteractionEvent:this.sendBoxInteractionEventProxy.bind(this),registerEventCallback:this.registerEventCallback.bind(this)}}}],[{key:"toCamelCase",value:function(e){return e.replace(/^([A-Z])|[\s|_-](\w)/g,(function(e,t,n){return n?n.toUpperCase():t.toLowerCase()}))}},{key:"getCustomParamsForView",value:function(t){var n=t.contextNode,i=t.customParams,r=void 0===i?{}:i,o=e.extractCustomParams(n,"data-analytics-view-opbox-custom-"),a=Object.keys(o).length?{_opbox:o}:{};return L(e.extractCustomParams(n,"data-analytics-view-custom-"),a,r)}},{key:"getCustomParamsForClick",value:function(t){var n=t.contextNode,i=t.coordinates,r=void 0===i?{}:i,o=t.destinationUrl,a=void 0===o?"":o,s=t.customParams,u=void 0===s?{}:s,c=t.isNewTab,l=c?{isNewTab:c}:{},d=Object.assign(e.extractCustomParams(n,"data-analytics-click-opbox-custom-"),{destinationUrl:a},l,r);return L(e.extractCustomParams(n,"data-analytics-click-custom-"),{_opbox:d},u)}},{key:"getCustomParamsForInteraction",value:function(t){var n=t.contextNode,i=t.customParams,r=void 0===i?{}:i,o=e.extractCustomParams(n,"data-analytics-interaction-custom-"),a=e.extractCustomParams(n,"data-analytics-interaction-opbox-custom-"),s=Object.keys(a).length?{_opbox:a}:{};return L(o,s,r)}},{key:"extractCustomParams",value:function(t,n){for(var i={},r=0;r<t.attributes.length;r+=1){var o=t.attributes[r];if(0===o.name.indexOf(n)){var a=o.name.replace(n,"");i[e.toCamelCase(a)]=o.value}}return i}},{key:"extractBoxViewCustomParams",value:function(e){if(!e)return{};var t=e.getAttribute("data-analytics-box-view-custom-params");if(!t)return{};var n={};try{n=JSON.parse(decodeURIComponent(t))}catch(e){console.log(e)}return n}},{key:"mergeAnalyticsTags",value:function(e,t){var n=e.split(","),i=t.split(","),r=[].concat(v(n),v(i));return r.filter((function(e,t){return e&&r.indexOf(e)===t}))}},{key:"extractAnalyticsTags",value:function(t){var n=t.closest("[".concat("data-analytics-tags","]"));if(!n)return[];var i=!!n.closest("[".concat("data-item","]")),r=i?n.closest("[".concat("data-box-name","][").concat("data-analytics-tags","]")).getAttribute("data-analytics-tags"):n.getAttribute("data-analytics-tags"),o=i?n.getAttribute("data-analytics-tags"):"";return e.mergeAnalyticsTags(r,o)}},{key:"extractGroups",value:function(e){var t=e.closest("[data-analytics-groups]");if(t){var n=decodeURIComponent(t.getAttribute("data-analytics-groups"));try{n=JSON.parse(n)}catch(e){return console.log("JSON.parse error! Can not convert ".concat(n," to JSON.")),[]}return n}return[]}},{key:"hasFragmentAsImmediateChild",value:function(e){return E(e.childNodes).some((function(e){return e.classList&&e.classList.contains("opbox-fragment")}))}}]),e}(),z=function(){function n(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).targetWindow;t(this,n),this.targetWindow=e,this.implementationsRegistry=new Map,this.instancesRegistry=new Map}return i(n,[{key:"getDomNodes",value:function(e){var t=this.targetWindow.document.querySelectorAll('[data-prototype-id="'.concat(e,'"]'));return t?Array.from(t):[]}},{key:"init",value:function(e,t){var n=e.prototypeName;n&&t({domNodes:this.getDomNodes(n)})}},{key:"reportError",value:function(e){var t="Cannot register component. ".concat(e);console.error(t),this.targetWindow.newrelic&&this.targetWindow.newrelic.noticeError(t)}},{key:"isPrototypeObjectValid",value:function(t){var n=t.prototypeName;return"string"!=typeof n?(this.reportError('Property "prototypeName" must be string but got '.concat(e(n))),!1):""!==n||(this.reportError('Property "prototypeName" cannot be empty string'),!1)}},{key:"containsValidPrototypes",value:function(e){var t=this;return 0===e.length?(this.reportError("Empty handledPrototypes list"),!1):!e.filter((function(e){return!t.isPrototypeObjectValid(e)})).length}},{key:"isPrototypeValid",value:function(e){return w(e)?this.containsValidPrototypes(e):k(e)?this.isPrototypeObjectValid(e):(this.reportError('"handledPrototype" argument must be an object or an array'),!1)}},{key:"isImplementationValid",value:function(t){return x(t)?t.prototype.onUpdate&&!x(t.prototype.onUpdate)?(this.reportError('"onUpdate" property must be a function or undefined but got '.concat(e(t.prototype.onUpdate))),!1):!!x(t.prototype.onMount)||(this.reportError('"implementation" class has to have "onMount" method'),!1):(this.reportError('"implementation" must be a class'),!1)}},{key:"registerImplementationAndInstances",value:function(e,t){this.implementationsRegistry.has(e)?this.reportError("".concat(e," already registered!")):(this.implementationsRegistry.set(e,t),this.registerInstances(this.getDomNodes(e),t))}},{key:"updateComponentCallback",value:function(e,t){var n=this.instancesRegistry.get(e);n&&x(n.onUpdate)&&n.onUpdate(t)}},{key:"beforeUpdateComponentCallback",value:function(){this.instancesRegistry.forEach((function(e){x(e.beforeOnUpdate)&&e.beforeOnUpdate()}))}},{key:"getSerializedProps",value:function(e){var t=this.targetWindow.document.querySelector('[data-serialize-box-name="'.concat(e,'"]'));if(!t)return{};try{return JSON.parse(t.innerHTML)}catch(e){return this.targetWindow.newrelic&&this.targetWindow.newrelic.noticeError(e),{}}}},{key:"registerInstances",value:function(e,t){var n=this;e.forEach((function(e){var i=e.getAttribute("data-box-name"),r=n.getSerializedProps(i),o=new t({baseNode:e,props:r});n.instancesRegistry.set(i,o),o.onMount()}))}},{key:"register",value:function(e,t){var n=this;this.isPrototypeValid(e)&&this.isImplementationValid(t)&&(w(e)?e.forEach((function(e){var i=e.prototypeName;n.registerImplementationAndInstances(i,t)})):this.registerImplementationAndInstances(e.prototypeName,t))}},{key:"createAPI",value:function(){return{init:this.init.bind(this),register:this.register.bind(this)}}}]),n}(),F=function(){function n(e){var i=e.httpClient,r=e.config,o=void 0===r?{}:r;t(this,n),this.httpClient=i,this.edgeHost=o.edgeHost,this.defaultRequestSettings={headers:{"Content-type":"application/vnd.allegro.public.v1+json",Accept:"application/vnd.allegro.public.v1+json"}},this.get=this.get.bind(this),this.put=this.put.bind(this),this.post=this.post.bind(this),this.patch=this.patch.bind(this),this.delete=this.delete.bind(this)}return i(n,[{key:"prepareRequestSettings",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.disableDefaultHeaders)return e;var t=this.normalizeSettings(e);return L({},this.defaultRequestSettings,t)}},{key:"normalizeSettings",value:function(t){if(!t||!t.headers)return t;var n=function t(n,i){return Object.keys(n).reduce((function(r,o){var a=n[o],s="object"===e(a)?t(a,i):a;return r[i.find((function(e){return o.toLowerCase()===e.toLowerCase()}))||o]=s,r}),{})}(t.headers,Object.keys(this.defaultRequestSettings.headers));return Object.assign(t,{headers:n})}},{key:"prepareRequestUrl",value:function(e){return this.edgeHost+e}},{key:"get",value:function(e,t){return this.edgeHost?this.httpClient.get(this.prepareRequestUrl(e),this.prepareRequestSettings(t)):Promise.reject("missing edge host")}},{key:"put",value:function(e,t,n){return this.edgeHost?this.httpClient.put(this.prepareRequestUrl(e),t,this.prepareRequestSettings(n)):Promise.reject("missing edge host")}},{key:"post",value:function(e,t,n){return this.edgeHost?this.httpClient.post(this.prepareRequestUrl(e),t,this.prepareRequestSettings(n)):Promise.reject("missing edge host")}},{key:"patch",value:function(e,t,n){return this.edgeHost?this.httpClient.patch(this.prepareRequestUrl(e),t,this.prepareRequestSettings(n)):Promise.reject("missing edge host")}},{key:"delete",value:function(e,t){return this.edgeHost?this.httpClient.delete(this.prepareRequestUrl(e),this.prepareRequestSettings(t)):Promise.reject("missing edge host")}},{key:"createAPI",value:function(){return{get:this.get,put:this.put,post:this.post,patch:this.patch,delete:this.delete}}}]),n}(),_=function(){function e(n){var i=n.targetWindow,r=n.alias,o=void 0===r?"cm":r,a=n.config,s=void 0===a?{}:a,u=n.isExternal,c=void 0!==u&&u;t(this,e);var l=s.cookieMonster,d=l.host,h=l.account,f=l.defaultCustomParams,m=void 0===f?{}:f,v=l.referrer,g=void 0===v?document.referrer:v;this.targetWindow=i,this.document=this.targetWindow.document,this.alias=o,this.host=d,this.account=h,this.isExternal=c,this.defaultCustomParams=m,this.referrer=g}return i(e,[{key:"initialize",value:function(){if(this.isExternal)return this.loadExternal(),void this.callCookieMonster.call(this,"create",this.account);this.host&&this.account&&!this.isLoaded()?(this.load(),this.callCookieMonster.call(this,"create",this.account),this.sendPageView(),this.updateReferrer()):this.updateReferrer()}},{key:"load",value:function(){this.isLoaded()||function(e,t,n,i,r){e["cm.analytics.object"]=r,e[r]=e[r]||function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e[r].q=e[r].q||[]).push(n)};var o=C(t,"script",{src:i}),a=t.getElementsByTagName("script")[0];a.parentNode.insertBefore(o,a)}(this.targetWindow,this.document,0,this.host,this.alias)}},{key:"loadExternal",value:function(){this.isLoaded()||function(e,t){e["cm.analytics.object"]=t,e[t]=e[t]||function(){for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];(e[t].q=e[t].q||[]).push(i)}}(this.targetWindow,this.alias)}},{key:"send",value:function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=this.callCookieMonster).call.apply(e,[this,this.sendCommand()].concat(n))}},{key:"sendPageView",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.defaultCustomParams.pv||{};this.send("pageview",{customParams:e,referrer:this.referrer})}},{key:"updateReferrer",value:function(){this.referrer=window.location.href}},{key:"callCookieMonster",value:function(){if(this.isLoaded()){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.targetWindow[this.alias].apply(null,t)}}},{key:"isLoaded",value:function(){return"function"==typeof this.targetWindow[this.alias]}},{key:"sendCommand",value:function(){return"send@".concat(this.account)}}]),e}(),J=function(){function e(n){var i=n.targetWindow,r=n.opboxWebClient,o=n.rawDataListenersRegistry;t(this,e),this.targetWindow=i,this.opboxWebClient=r,this.rawDataListenersRegistry=o,this.history=[i.location.pathname],this.recentlyFetchedURL=e.getPageUrlFromTarget(i.location)}return i(e,[{key:"initialize",value:function(){var e=this;this.targetWindow.onpopstate=function(t){return e.handlePopState(t)},this.targetWindow.history.replaceState({opboxjs:!0},"")}},{key:"isInternalNavigation",value:function(e){return this.history.find((function(t){return t===e}))}},{key:"navigateRelative",value:function(t){var n=this.targetWindow.location,i=n.pathname,r=n.search,o=i+r,a=i+e.resolve(r,t);return this.changeUrl(a),this.history.push(i),this.targetWindow.performance&&"function"==typeof this.targetWindow.performance.mark&&this.targetWindow.performance.mark("clientSideNavigationStart"),a!==o&&this.fetch(a),a}},{key:"refreshPage",value:function(){var e=this.targetWindow.location,t=e.pathname+e.search;this.fetch(t)}},{key:"changeUrl",value:function(e){return this.targetWindow.history.pushState("","",e)}},{key:"handlePopState",value:function(t){var n=t.target.location.pathname,i=e.getPageUrlFromTarget(t.target.location);this.isInternalNavigation(n)&&this.recentlyFetchedURL!==i&&this.refreshPage()}},{key:"fetch",value:function(t){var n=this;this.recentlyFetchedURL=e.getPageUrlFromTarget(this.targetWindow.location),this.rawDataListenersRegistry.triggerProgressListener(),this.opboxWebClient.getPageData(t).then((function(e){return n.rawDataListenersRegistry.triggerChangeListener(e)})).catch((function(e){return console.error(e)}))}}],[{key:"getPageUrlFromTarget",value:function(e){var t=e.origin,n=e.pathname,i=e.search;return"".concat(t).concat(n).concat(i)}},{key:"resolve",value:function(e,t){function n(e){for(var t,n,i,r,o=new RegExp("([^&=]+)=?([^&]*)","g"),a={},s=e.substring(e.indexOf("?")+1,e.length);t=o.exec(s);)n=a,i=decodeURIComponent(t[1]),r=decodeURIComponent("string"===t[1]?t[2].replace(/\+/g," "):t[2]),void 0===n[i]?n[i]=[r]:n[i].push(r);return a}var i,r,o=n(e),a=function(e,t){for(var n=0,i=e.length;n<i;n+=1)if(t(e[n],n,e))return e[n];return null}(o,(r="route",function(e){return e.name===r}));function s(e){t.forEach((function(t){return n=e,i=t.name,r=t.value,void(n[i]=Array.isArray(r)?r:[r]);var n,i,r}))}function u(e){return Object.keys(e).map((function(t){return e[t].map((function(e){return[t,e]}))})).reduce(T,[]).reduce((function(e,t){var n=m(t,2),i=n[0],r=n[1];return null!=r?"".concat(e).concat((e?"&":"?")+encodeURIComponent(i),"=").concat(encodeURIComponent(r)):e}),"")}return a&&0===a.value.indexOf("http")?(s(i=2===a.value.split("?").length?n(a.value.split("?")[1]):[]),a.value=a.value.split("?")[0]+u(i)):s(o),u(o)}}]),e}(),G=500,X="opboxAnimationTimerInterval",$={easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e}},Y=function(e){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||function(e){setTimeout(e,1e3/60)}};function K(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=r.duration,a=void 0===o?G:o,s=r.onFinish;if("function"!=typeof i)return null;var u=Y(e),c=Date.now(),l=n-t,d=!1;return function e(){var n=Date.now()-c;if(d||n>=a)"function"==typeof s&&s(),d=!1;else{var r=Math.min(n/a,1),o=$.easeInOutQuart(r)*l+t;i(o),u(e)}}(),{stop:function(){d=!0}}}function Q(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).duration,i=void 0===n?G:n,r=e.pageYOffset,o=Math.max(0,t),a=e.document.body.scrollHeight;function s(){e[X]&&"function"==typeof e[X].stop&&(e[X].stop(),e[X]=null)}s(),e[X]=K(e,r,t,(function(t){var n,i,r;e.scrollTo(0,Math.round(t)),i=(n=t)===o||n===o,r=e.innerHeight+n>=a,(i||r)&&s()}),{duration:i})}var Z=function(){function e(n){var i=n.targetWindow;t(this,e),this.targetWindow=i,this.document=i.document}return i(e,[{key:"getBoxAnchorNode",value:function(e){return"string"!=typeof e?null:this.document.querySelector('a[name="'.concat(e,'"]'))}},{key:"getTopOffset",value:function(e){var t=this.targetWindow.pageYOffset||this.document.documentElement.scrollTop||0;return e?e.getBoundingClientRect().top+t:null}},{key:"scrollTo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.animate,i=void 0===n||n,r={duration:i?500:0};if("number"!=typeof e){var o=this.getBoxAnchorNode(e);if(o){var a=this.getTopOffset(o);Q(this.targetWindow,a,r)}}else Q(this.targetWindow,e,r)}},{key:"tween",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];K.apply(void 0,[this.targetWindow].concat(t))}}]),e}(),ee=window.performance,te=ee&&"function"==typeof ee.mark?ee.mark.bind(ee):function(){};function ne(t,n){t.forEach((function(t){var i=t.args,r=t.reject,o=t.resolve,a=function(t,n){try{return t.apply(void 0,v(n))}catch(t){return console.error(t),void("object"===e("NREUM")&&null!==NREUM&&"function"==typeof NREUM.noticeError&&NREUM.noticeError(t))}}(n,i);a&&x(a.then)&&x(o)&&x(r)&&a.then(o,r)}))}var ie="opbox.preferences",re=2592e6,oe=function(){return Date.now()},ae=function(){return{setItem:function(){},getItem:function(){return{}}}};var se=function(){function e(n){var i=n.localStorage,r=n.ttlMs,o=void 0===r?re:r,a=n.key,s=void 0===a?ie:a,u=n.timeProvider,c=void 0===u?oe:u;t(this,e),this.writeToStorage=this.writeToStorage.bind(this),this.loadPreferences=this.loadPreferences.bind(this),this.cleanupPreferences=this.cleanupPreferences.bind(this),this.savePreferences=this.savePreferences.bind(this),this.storage=function(e){try{var t="test_preferences_storage";return e.setItem(t,t),e.getItem(t),e.removeItem(t),!0}catch(e){return!1}}(i)?i:ae(),this.ttlMs=o,this.key=s,this.timeProvider=c}return i(e,[{key:"savePreferences",value:function(e){var t=this.loadPreferences(),n=this.timeProvider(),i=e.reduce((function(e,t){return a({},e,r({},t.name,{value:t.value,timestamp:n}))}),t);this.writeToStorage(i)}},{key:"writeToStorage",value:function(e){try{this.storage.setItem(this.key,JSON.stringify(e))}catch(e){window.newrelic&&window.newrelic.noticeError(e)}}},{key:"loadPreferences",value:function(){try{return JSON.parse(this.storage.getItem(this.key))||{}}catch(e){return window.newrelic&&window.newrelic.noticeError(e),{}}}},{key:"cleanupPreferences",value:function(){var e=this,t=this.loadPreferences(),n=this.timeProvider(),i=Object.entries(t).reduce((function(t,i){var o=m(i,2),s=o[0],u=o[1];return u.timestamp+e.ttlMs>n?a({},t,r({},s,u)):t}),{});this.writeToStorage(i)}}]),e}(),ue={withCredentials:!0,headers:{"Content-type":"application/vnd.allegro.internal.v1+json",Accept:"application/vnd.allegro.internal.v1+json"}},ce=function(){function n(e){var i=e.edgeClient,r=e.localStorage,o=e.ttlMs;t(this,n),this.edgeClient=i,this.storage=new se({localStorage:r,ttlMs:o}),this.setPreference=this.setPreference.bind(this),this.getPreference=this.getPreference.bind(this),this.getPreferences=this.getPreferences.bind(this),this.getPreferencesFromLocalStorageOrDefaults=this.getPreferencesFromLocalStorageOrDefaults.bind(this)}return i(n,[{key:"setPreference",value:function(e,t){var n={name:e,value:t};return this.storage.savePreferences([n]),this.edgeClient.post("/preferences",n,ue)}},{key:"getPreference",value:function(e,t){return"string"==typeof e||e instanceof String?this.getPreferences(r({},e,t)).then((function(t){return t[e]})):Promise.reject(Error("illegal argument type provided as preference name"))}},{key:"getPreferences",value:function(t){var n=this;if("object"!==e(t))return Promise.reject(Error("illegal argument type provided as preferences"));var i=Object.keys(t).join(","),o="".concat("/preferences","?name=").concat(i);return this.edgeClient.get(o,ue).then((function(e){return n.storage.savePreferences(e.data.preferences),e.data.preferences.reduce((function(e,t){return a({},e,r({},t.name,t.value))}),{})})).catch((function(){return n.getPreferencesFromLocalStorageOrDefaults(t)}))}},{key:"getPreferencesFromLocalStorageOrDefaults",value:function(e){this.storage.cleanupPreferences();var t=this.storage.loadPreferences();return Object.entries(e).reduce((function(e,n){var i=m(n,2),o=i[0],s=i[1];return a({},e,r({},o,o in t?t[o].value:s))}),{})}},{key:"createAPI",value:function(){return{set:this.setPreference,get:this.getPreference,getMany:this.getPreferences}}}]),n}();function le(e,t){var n=e.navigator.serviceWorker,i=e.location.href;n&&(function(e,t,n){"function"==typeof e.addEventListener&&e.addEventListener("message",(function(e){"installed"===e.data&&t("event","PWA","serviceworker-registered",null,n)}))}(n,t,i),function(e,t){if("function"!=typeof e.getRegistrations)return Promise.resolve();var n=function(e){return e.unregister().then((function(t){return t?e.active.scriptURL:""}))};e.getRegistrations().then((function(e){return Promise.all(e.map(n))})).then((function(e){var n=e.filter(Boolean);n.length>0&&t("event","PWA","serviceworker-unregistered",null,n.join(","))}))}(n,t))}var de=new(function(){function e(n,i,r){t(this,e),this.targetWindow=n;var o=p.fromWindow(this.targetWindow),a=new y({targetWindow:n}),s=new _({targetWindow:n,config:o}),u=new U({targetWindow:n}),c=new q({targetWindow:n,config:o,cookieMonsterClient:s,boxViewsMarker:u,sendPerformanceMetrics:this.sendPerformanceMetrics.bind(this)}),l=new z({targetWindow:n}),d=new W({appContext:a,analytics:c,updateComponentCallback:l.updateComponentCallback.bind(l),beforeUpdateComponentCallback:l.beforeUpdateComponentCallback.bind(l)}),h=new M({httpClient:i});this.config=o,this.cookieMonsterClient=s,this.boxViewsMarker=u,this.analytics=c,this.component=l,this.rawDataListenersRegistry=d,this.opboxWebClient=h,this.navigation=new J({targetWindow:n,opboxWebClient:h,rawDataListenersRegistry:d}),this.edgeClient=new F({httpClient:r,config:o}),this.preferencesClient=new ce({edgeClient:this.edgeClient,localStorage:this.targetWindow.localStorage}),this.uiTools=new Z({targetWindow:n}),this.analytics.initialize(),this.navigation.initialize(),this.boxViewsMarker.initialize()}return i(e,[{key:"domReadyHelper",value:function(e){"loading"===this.targetWindow.document.readyState?this.targetWindow.document.addEventListener("DOMContentLoaded",e):this.targetWindow.setTimeout(e,0)}},{key:"broadcastAPILoadEvent",value:function(){var e=function(e,t){var n=t.document.createEvent("CustomEvent");return n.initCustomEvent(e,!0,!0,{}),n}("opboxAPILoaded",this.targetWindow);this.targetWindow.dispatchEvent(e)}},{key:"attach",value:function(){var e,t,n=this,i=p.getGlobal(this.targetWindow),r=this.API;i&&(!function e(t,n,i){for(var r=arguments.length,o=new Array(r>3?r-3:0),a=3;a<r;a++)o[a-3]=arguments[a];if(x(t)&&x(n)){if(!t.__queue__)return;ne(t.__queue__,n),i.apply(void 0,[n].concat(o))}else k(t)&&k(n)&&Object.keys(t).forEach((function(r){e.apply(void 0,[t[r],n[r],i].concat([].concat(o,[r])))}))}(i,r,(function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];return p.assignToGlobal(n.targetWindow,O.apply(void 0,[i,e].concat(r)))})),e=i,t=p.getWhitelist(r),Object.keys(e).forEach((function(n){t.includes(n)||delete e[n]})),Object.freeze(i)),this.config.pinter.enabled&&Promise.resolve().then((function(){return kt})).then((function(e){n.pinterInstance=e.default(n.config.pinter.samplingRate,n.targetWindow),te("PinterInit")})),le(this.targetWindow,this.cookieMonsterClient.send.bind(this.cookieMonsterClient)),te("OpboxInit"),this.broadcastAPILoadEvent()}},{key:"sendPerformanceMetrics",value:function(){this.pinterInstance&&this.pinterInstance.sendUserTimings&&this.pinterInstance.sendUserTimings()}},{key:"run",value:function(){this.attach()}},{key:"API",get:function(){return{analytics:this.analytics.createAPI(),boxViewsMarker:this.boxViewsMarker.createAPI(),component:this.component.createAPI(),onData:this.rawDataListenersRegistry.registerListener.bind(this.rawDataListenersRegistry),changeParams:this.navigation.navigateRelative.bind(this.navigation),refreshPage:this.navigation.refreshPage.bind(this.navigation),tween:this.uiTools.tween.bind(this.uiTools),scrollTo:this.uiTools.scrollTo.bind(this.uiTools),page:this.opboxWebClient.createAPI(),edge:this.edgeClient.createAPI(),preferences:this.preferencesClient.createAPI(),onDomReady:this.domReadyHelper.bind(this),loaded:!0,performance:p.getGlobal(this.targetWindow).performance}}}]),e}())(window,new g,new g);de.run();de.attach.bind(de);function he(e){return(he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fe(e,t){return ve(e)||function(e,t){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}(e,t)||ge()}function me(e){return ve(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||ge()}function ve(e){if(Array.isArray(e))return e}function ge(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var pe="Performance",ye=16,be=1,ke="mark",we="resource",xe="navigation",Ee="paint",Ce=function(e){return"object"===he(e)},Pe=function(e){return e.length},Se=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.value,n=e.label,i=void 0===n?"Mark":n,r=e.params;return{category:pe,label:i,value:t,customParams:r}},Te=function(e){return e.startTime},Oe=function(e){return Se({value:e.name,params:{st:Math.round(Te(e))}})},Ae=function(e,t){"function"==typeof t.cm?t.cm("send","event",e):console.log("Cannot send performance data",e)},je=function(e){return function(t){return[].slice.call(e.querySelectorAll(t)||[])}},Ve=["navigationStart","unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"],Re=0,Ie=-1;function Ne(e){var t,n,i=(t=e.timing,n=void 0===t?{}:t,Ve.map((function(e){return{name:e,value:n[e]}}))),r=i[0].value;return i.slice(1).map((function(e){return function(e,t){var n=t-e;return!t||t<Re||e<Re||n<Re?Ie:n}(r,e.value)}))}var Me="###",Be=function(e){return"optimizely:"===e.name.substring(0,"optimizely:".length)};function We(e){var t,n=e,i=new Set,r=function(e){i.add(o(e))},o=function(e){return[e.name,e.entryType,Te(e),e.duration].join(Me)},a=function(e){return{duration:e.duration,entryType:e.entryType,name:e.name,startTime:Te(e)}};return function(){if(!n.getEntriesByType)return[];var e=n.getEntriesByType(ke).filter((function(e){return!Be(e)&&!function(e){return i.has(o(e))}(e)})).sort((function(e,t){return Te(e)-Te(t)}));if(0===e.length)return e;var s,u=(s=function(e){return"clientSideNavigationStart"===e.name},e.reduce((function(e,t){var n=fe(e,2),i=n[0],r=n[1];return s(t)?[i.concat([t]),r]:[i,r.concat([t])]}),[[],[]])),c=fe(u,2),l=c[0],d=c[1];return e.forEach(r),l.length>0?(t=Te(function(e){return e[e.length-1]}(l)),d.map((function(e){var t=function(e,t){for(var n=t.length-1;n>=0;n--){var i=t[n];if(e(i))return i}return null}((function(t){return Te(t)<Te(e)}),l);return t?Object.assign(a(e),{startTime:Te(e)-Te(t)}):a(e)}))):t?e.map((function(e){return Object.assign(a(e),{startTime:Te(e)-t})})):e.map(a)}}var Le=5e3,Ue=10,De=40;function He(e){for(var t=0,n=Date.now();t<Le&&Date.now()-n<e;)t++;return t}var qe="script",ze="".concat(qe).concat("[src]"),Fe="".concat(qe,":not(").concat("[src]",")"),_e="style",Je="link",Ge="".concat(Je,'[rel="stylesheet"]'),Xe="img",$e="image",Ye=1e6;function Ke(e){return"number"==typeof e&&e>=0?Math.min(Math.round(1e3*e),Ye):-1}var Qe=["allegro.pl","assets.allegrostatic.pl","cdn.allegrostatic.com","assets.allegrostatic.com"];function Ze(e,t){var n=t.getEntriesByType(we),i=je(e),r=function(e){return function(t){return t.initiatorType===e}},o=r(Xe),a=r($e),s=n.filter(r(Je)),u=fe(function(e){var t=[],n=[];return e.forEach((function(e){for(var i=0;i<Qe.length;i++){var r=Qe[i];if(0===e.name.indexOf("https://"+r+"/")){t.push(e);break}}i===Qe.length&&n.push(e)})),[t,n]}(n.filter(r(qe))),2),c=u[0],l=u[1],d=n.filter((function(e){return o(e)||a(e)}));return[[s,Ge],[c,ze],[l,ze],[d,Xe]].map((function(e){return function(e,t){var n=function(e,t){var n=t.reduce((function(e,t){return e[t.href||t.src]=!0,e}),{});return e.filter((function(e){return!0===n[e.name]}))}(e,t),i=function(e){return e.reduce((function(e,t){var n=fe(e,2),i=n[0],r=n[1];return[i+(t.encodedBodySize||0),r+(t.transferSize||0)]}),[0,0])}(n);return function(e){var t=0,n=0,i=0;return e.forEach((function(e){e.transferSize>0?n++:e.encodedBodySize>0?t++:i++})),[t,n,i]}(n).concat(i)}(e[0],i(e[1]))}))}function et(e,t,n){if(!n.getEntriesByType)return null;var i=(He(Ue),He(De)),r=function(e,t){var n=je(e),i=je(e.body),r=t.getEntriesByType(xe)[0]||{},o=Pe(n(Fe)),a=Pe(n(qe))-o;return[n("*"),e.documentElement.innerHTML,r.encodedBodySize||-1,r.transferSize||-1,n(_e),n(Ge),o,a,n([Xe,$e].join(",")),n("video"),n("iframe"),n(["meta","noscript","head","base","title",qe,Je,_e].join(",")),Pe(i("*"))-Pe(i([Je,_e,qe,"noscript"].join(",")))].map((function(e){var t=Pe(e);return void 0===t?e:t}))}(e,n),o=me(function(e){if(!Ce(e.connection))return Array(5).fill(null);var t=e.connection,n=t.type,i=void 0===n?"":n,r=t.effectiveType,o=void 0===r?"":r,a=t.downlinkMax,s=void 0===a?-1:a,u=t.downlink,c=void 0===u?-1:u,l=t.rtt,d=void 0===l?-1:l;return[i,o,Ke(s),Ke(c),d]}(t)),a=o[0],s=o[1],u=o.slice(2),c=function(e){var t=function(t){var n=e.getEntriesByName(t,Ee)[0];return n?Math.round(n.startTime):-1};return[t("first-paint"),t("first-contentful-paint")]}(n),l=fe(Ze(e,n),4),d=l[0],h=l[1],f=l[2],m=l[3];return{category:pe,label:"ResourceInformation",customParams:{v:be,bs:[i],ds:r,nct:a,net:s,ns:u,ps:c,tst:d,tis:h,tes:f,tim:m}}}var tt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},nt="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){e!=Array.prototype&&e!=Object.prototype&&(e[t]=n.value)},it=tt;function rt(){rt=function(){},it.Symbol||(it.Symbol=at)}var ot=0;function at(e){return"jscomp_symbol_"+(e||"")+ot++}function st(){rt();var e=it.Symbol.iterator;e||(e=it.Symbol.iterator=it.Symbol("iterator")),"function"!=typeof Array.prototype[e]&&nt(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return ut(this)}}),st=function(){}}function ut(e){var t=0;return function(e){return st(),(e={next:e})[it.Symbol.iterator]=function(){return this},e}((function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}))}function ct(e){st();var t=e[Symbol.iterator];return t?t.call(e):ut(e)}function lt(e){for(var t=[],n=(e=ct(e)).next();!n.done;n=e.next())n=n.value,t.push({timestamp:n.start,type:"requestStart"}),t.push({timestamp:n.end,type:"requestEnd"});for(t.sort((function(e,t){return e.timestamp-t.timestamp})),e=0,n=t.length-1;0<=n;n--){var i=t[n];switch(i.type){case"requestStart":e--;break;case"requestEnd":if(2<++e)return i.timestamp;break;default:throw Error("Internal Error: This should never happen")}}return 0}function dt(){var e=window.__tti&&window.__tti.e,t=window.__tti&&window.__tti.o;this.a=e?e.map((function(e){return{start:e.startTime,end:e.startTime+e.duration}})):[],t&&t.disconnect(),this.b=[],this.g=null,this.i=-1/0,this.f=!1,this.c=this.h=null,function(e){e.c=new PerformanceObserver((function(t){for(var n=(t=ct(t.getEntries())).next();!n.done;n=t.next())if("resource"===(n=n.value).entryType&&["link","script","iframe","video"].includes(n.initiatorType)&&(e.b.push({start:n.fetchStart,end:n.responseEnd}),ft(e,lt(e.b)+5e3)),"longtask"===n.entryType){var i=n.startTime+n.duration;e.a.push({start:n.startTime,end:i}),ft(e,i+5e3)}})),e.c.observe({entryTypes:["longtask","resource"]})}(this)}function ht(e){e.f=!0;var t=0<e.a.length?e.a[e.a.length-1].end:0,n=lt(e.b);ft(e,Math.max(n+5e3,t))}function ft(e,t){!e.f||e.i>t||(clearTimeout(e.g),e.g=setTimeout((function(){var t=performance.timing.navigationStart,n=lt(e.b);if(t=(window.a&&window.a.j?1e3*window.a.j().l-t:0)||performance.timing.domContentLoadedEventEnd-t,performance.timing.domContentLoadedEventEnd){var i=performance.timing;i=i.domContentLoadedEventEnd-i.navigationStart}else i=null;var r=performance.now();null===i&&ft(e,Math.max(n+5e3,r+1e3));var o=e.a;(n=5e3>r-n?null:5e3>r-(n=o.length?o[o.length-1].end:t)?null:Math.max(n,i))&&(e.h(n),clearTimeout(e.g),e.f=!1,e.c&&e.c.disconnect()),ft(e,performance.now()+1e3)}),t-performance.now()),e.i=t)}dt.prototype.getFirstConsistentlyInteractive=function(){var e=this;return new Promise((function(t){e.h=t,"complete"==document.readyState?ht(e):window.addEventListener("load",(function(){ht(e)}))}))};var mt=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.window=t,this.document=t.document,this.navigator=t.navigator,this.performance=t.performance,this.sender=i,this.pageName=n,this.getUserTiming=We(this.performance)}var t;return(t=[{key:"sendNavigationTiming",value:function(){this.sendEvent(function(e,t){return{category:pe,label:"NavigationTiming",customParams:{m:Ne(e),v:be,page:t}}}(this.performance,this.pageName))}},{key:"sendUserTimings",value:function(){var e=this;this.getUserTiming().map(Oe).forEach((function(t){return e.sendEvent(t)}))}},{key:"sendResourceInformation",value:function(){this.sendEvent(et(this.document,this.navigator,this.performance))}},{key:"sendEvent",value:function(e){null!==e&&this.sender.call(null,e)}},{key:"measureTimeToConsistentlyInteractive",value:function(){var e=this;!function(e,t){(function(e){return"PerformanceLongTaskTiming"in e?(new dt).getFirstConsistentlyInteractive():Promise.resolve(null)})(e).then((function(e){e&&t(Se({value:"TimeToConsistentlyInteractive",params:{st:Math.round(e)}}))}),(function(){}))}(this.window,(function(t){return e.sendEvent(t)}))}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}(),vt=["regular","detail","user"];function gt(e,t){var n=t.pageName,i=void 0===n?"":n,r=t.sendInterval,o=void 0===r?500:r,a=t.samplingThreshold,s=void 0===a?ye:a;if(!function(e,t,n){return-1===vt.indexOf(n)||function(e,t){try{var n=function(e){return e.cookie.replace(/(?:(?:^|.*;\s*)_cmuid\s*=\s*([^;]*).*$)|^.*$/,"$1")}(e);return""===n?t>0:parseInt(n.charAt(0),16)<t}catch(e){return!1}}(e,t)}(e.document,s,i))return null;var u=new mt(e,i,(function(t){Ae(t,e)}));function c(){u.sendNavigationTiming(),u.sendResourceInformation()}return"complete"===e.document.readyState?c():e.addEventListener("load",(function(){e.setTimeout(c,0)})),e.setInterval((function(){u.sendUserTimings()}),o),u.sendUserTimings(),u.measureTimeToConsistentlyInteractive(),u}var pt=16;function yt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.dataLayer,n=e.location.pathname;return function(e){return e&&e[0]&&e[0].pageType||null}(t)||function(e){return e.split("/").slice(0,2).join("/")}(n)}function bt(e){return Math.floor(e*pt)}var kt=Object.freeze({default:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window;return gt(t,{pageName:yt(t),sendInterval:500,samplingThreshold:bt(e)})}})}();